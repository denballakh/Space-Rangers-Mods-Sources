Version=6
GlobalVars ~{
}
GlobalCode=
LocalVars ~{
    locations ~{
        Type=Unknown
        Value=None
    }
    TransportIds ~{
        Type=Unknown
        Value=None
    }
    DialogTypes ~{
        Type=Unknown
        Value=None
    }
    DialogStates ~{
        Type=Unknown
        Value=None
    }
    PirateIds ~{
        Type=Unknown
        Value=None
    }
    quest_ship ~{
        Type=Dword
        Value=0
    }
    talk_ship ~{
        Type=Integer
        Value=0
    }
    num_ship ~{
        Type=Integer
        Value=0
    }
    dtype ~{
        Type=Integer
        Value=0
    }
    offer_threat ~{
        Type=Integer
        Value=0
    }
    offer_money ~{
        Type=Integer
        Value=0
    }
    offer_protection ~{
        Type=Integer
        Value=0
    }
    num_deals ~{
        Type=Integer
        Value=0
    }
    money_required ~{
        Type=Integer
        Value=20000
    }
    quest_planet ~{
        Type=Dword
        Value=0
    }
    planet_owner ~{
        Type=Integer
        Value=0
    }
    num_pirates ~{
        Type=Integer
        Value=0
    }
    counter2 ~{
        Type=Integer
        Value=0
    }
    counter ~{
        Type=Integer
        Value=0
    }
    script_num ~{
        Type=Integer
        Value=0
    }
    quest_started ~{
        Type=Integer
        Value=0
    }
    quest_star ~{
        Type=Dword
        Value=0
    }
    max_duration ~{
        Type=Integer
        Value=180
    }
    StarNew ~{
        Type=Dword
        Value=0
    }
    PlanetNew ~{
        Type=Dword
        Value=0
    }
    GroupNew ~{
        Type=Dword
        Value=0
    }
    GroupTransports ~{
        Type=Dword
        Value=1
    }
    GroupPirates ~{
        Type=Dword
        Value=2
    }
    DialogPlanet ~{
        Type=Dword
        Value=0
    }
    DialogTransport ~{
        Type=Dword
        Value=1
    }
    DialogPlanetCancel ~{
        Type=Dword
        Value=2
    }
    DialogTransportPanic ~{
        Type=Dword
        Value=3
    }
}
Constellations=0
Stars ~{
    StarNew ~{
        Constellation=-1
        IsSubspace=False
        NoKling=False
        NoComeKling=False
        StarLinks ~{
        }
        Planets ~{
            PlanetNew ~{
                Race=Maloc,Peleng,People,Fei,Gaal
                Owner=Maloc,Peleng,People,Fei,Gaal
                Economy=Agriculture,Industrial,Mixed
                Government=Anarchy,Dictatorship,Monarchy,Republic,Democracy
                Range=0..100
                Dialog=
            }
        }
        Ships ~{
            0 ~{
                Count=1
                Owner=Maloc,Peleng,People,Fei,Gaal
                Type=Ranger,Warrior,Pirate,Transport,Liner,Diplomat
                IsPlayer=True
                Speed=0..10000
                Weapon=Undef
                CargoHook=0
                EmptySpace=0
                Rating=0..1000
                Status ~{
                    Trader=0..100
                    Warrior=0..100
                    Pirate=0..100
                }
                Score=0..1000000
                Strength=0.0..0.0
                Ruins=
            }
        }
    }
}
Places ~{
}
Items ~{
}
Groups ~{
    GroupNew ~{
        Planet=PlanetNew
        State=0(StateNew)
        Owner=Maloc,Peleng,People,Fei,Gaal
        Type=Ranger,Warrior,Pirate,Transport,Liner,Diplomat
        Count=1..1
        Speed=100..10000
        Weapon=Undef
        CargoHook=0
        EmptySpace=0
        Friendship=Free
        AddPlayer=True
        Rating=0..1000
        Score=0..1000000
        Status ~{
            Trader=0..100
            Warrior=0..100
            Pirate=0..100
        }
        SearchDist=10000
        Dialog=
        Strength=0.0..0.0
        Ruins=
    }
    GroupTransports ~{
        Planet=PlanetNew
        State=1(StateFree)
        Owner=Maloc,Peleng,People,Fei,Gaal
        Type=Ranger,Warrior,Pirate,Transport,Liner,Diplomat
        Count=0..0
        Speed=100..10000
        Weapon=Undef
        CargoHook=0
        EmptySpace=0
        Friendship=Free
        AddPlayer=False
        Rating=0..1000
        Score=0..1000000
        Status ~{
            Trader=0..100
            Warrior=0..100
            Pirate=0..100
        }
        SearchDist=10000
        Dialog=
        Strength=0.0..0.0
        Ruins=
    }
    GroupPirates ~{
        Planet=PlanetNew
        State=1(StateFree)
        Owner=Maloc,Peleng,People,Fei,Gaal
        Type=Ranger,Warrior,Pirate,Transport,Liner,Diplomat
        Count=0..0
        Speed=100..10000
        Weapon=Undef
        CargoHook=0
        EmptySpace=0
        Friendship=Free
        AddPlayer=False
        Rating=0..1000
        Score=0..1000000
        Status ~{
            Trader=0..100
            Warrior=0..100
            Pirate=0..100
        }
        SearchDist=10000
        Dialog=
        Strength=0.0..0.0
        Ruins=
    }
}
GroupLinks ~{
}
InitCode=<<<
  locations=newarray(1);
  TransportIds=newarray(7);
  DialogTypes=newarray(7);
  DialogStates=newarray(7);
  PirateIds=newarray(7);
  counter=1;
  while (counter<ArrayDim(array_script_names)){
  if (array_chosen_planets[counter]==Id(PlanetNew)){script_num=counter;}
  counter=counter+1;}
>>>
TurnCode=<<<
  if (!quest_started && ShipIsTakeoff(Player())){
  ShipOut(Player());}
  if(quest_started) {
    if((num_deals+GroupCount(GroupTransports))<5) {
      Ether(5,'25D5D7BF-E866-417A-B07F-81CD0565E871',Format(CT("Script.PC_pla02.108"),"<0>",Name(PlanetNew)));
      while (GroupCount(GroupTransports)>0){ShipOut(GroupToShip(GroupTransports));}
      while (GroupCount(GroupPirates)>0){ShipOut(GroupToShip(GroupPirates));}
      ShipOut(Player());
      array_quest_statuses[script_num]=3;
    }
    if((quest_started+max_duration)<CurTurn()) {
      while (GroupCount(GroupTransports)>0){ShipOut(GroupToShip(GroupTransports));}
      while (GroupCount(GroupPirates)>0){ShipOut(GroupToShip(GroupPirates));}
      ShipOut(Player());
      array_quest_statuses[script_num]=3;
      Ether(5,'25D5D7BF-E866-417A-B07F-81CD0565E871',Format(CT("Script.PC_pla02.107"),"<0>",Name(PlanetNew)));
    }
    if(num_pirates>GroupCount(GroupPirates)) {
      counter=0;
      while (counter<7){
      num_ship=-1;
      counter2=0;
      if (DialogTypes[counter]==1){
      if (PirateIds[counter]>0){
      while (counter2<GroupCount(GroupPirates)){
      if (PirateIds[counter]==Id(GroupShip(GroupPirates,counter2))){num_ship=counter2;}
      counter2=counter2+1;}
      if (num_ship<0){
      counter2=0;
      while (counter2<GroupCount(GroupTransports)){
      if (TransportIds[counter]==Id(GroupShip(GroupTransports,counter2))){
      Ether(0,'E5F29D1D-64B2-4B29-A7E5-E00087848EB8',Format(CT("Script.PC_pla02.104"),"<0>",Name(GroupShip(GroupTransports,counter2))));
      num_deals=num_deals+1;
      ShipOut(GroupShip(GroupTransports,counter2));}
      counter2=counter2+1;}
      PirateIds[counter]=0;}}}
      counter=counter+1;}
      num_pirates=GroupCount(GroupPirates);
    }
    if(num_deals>4) {
      khan_counter=khan_counter+1;
      array_quest_statuses[script_num]=2;
      ShipOut(Player());
      while (GroupCount(GroupTransports)){ShipOut(GroupToShip(GroupTransports));}
      while (GroupCount(GroupPirates)){ShipOut(GroupToShip(GroupPirates));}
      Ether(4,'25D5D7BF-E866-417A-B07F-81CD0565E871',Format(CT("Script.PC_pla02.106"),"<0>",Name(PlanetNew)));
    }
  }
>>>
DialogBegin=<<<
  if(GetShipPlanet(Player())==PlanetNew) {
    if(request_dialog) {
      if(!quest_started) {
        request_dialog=0;
        counter=BuildListOfQuestPossibleLocations(locations,ShipStar(Player()),1,50);
        if(counter<8) {
          AddDialogOverride('DialogPlanetCancel',10);
        }
        if(counter>=8) {
          AddDialogOverride('DialogPlanet',10);
        }
      }
    }
  }
  if(GetTalkShip()) {
    talk_ship=Id(GetTalkShip());
    num_ship=-1;
    counter=0;
    while (counter<7){
    if (talk_ship==TransportIds[counter]){num_ship=counter;}
    counter=counter+1;}
    if(num_ship>=0) {
      if(DialogStates[num_ship]<2) {
        dtype=DialogTypes[num_ship];
        offer_threat=1;
        offer_money=1;
        offer_protection=1;
        AddDialogInject('DialogTransport','',CT("Script.PC_pla02.109"),1);
        if((DialogTypes[num_ship]==3) && (DialogStates[num_ship]==1)) {
          if((ShipGetBad(Player())==GetTalkShip()) || (ShipGetBad(GetTalkShip())==Player())) {
            if(HullDamage(GetTalkShip())>=50) {
              AddDialogOverride('DialogTransportPanic',10);
            }
          }
        }
      }
    }
  }
>>>
States ~{
    StateNew ~{
        Type=None
        Attack ~{
        }
        TakeItem=
        TakeAll=False
        OutMsg=
        InMsg=
        Ether=
        Code=
    }
    StateFree ~{
        Type=Free
        Attack ~{
        }
        TakeItem=
        TakeAll=False
        OutMsg=
        InMsg=
        Ether=
        Code=
    }
}
Dialogs ~{
    DialogPlanet ~{
        Code=<<<
            DChange(0);
            exit;
        >>>
    }
    DialogTransport ~{
        Code=<<<
            if(DialogStates[num_ship]==0) {
              DChange(1);
              exit;
            }
            if(DialogStates[num_ship]==1) {
              if(DialogTypes[num_ship]==3) {
                if(((ShipGetBad(Player())==CurShip) || (ShipGetBad(CurShip)==Player())) && (HullDamage(CurShip)>=50)) {
                  DChange(17);
                  exit;
                }
                if(((ShipGetBad(Player())!=CurShip) && (ShipGetBad(CurShip)!=Player())) || (HullDamage(CurShip)<50)) {
                  DChange(3);
                  exit;
                }
              }
              if(DialogTypes[num_ship]!=3) {
                DChange(3);
                exit;
              }
            }
        >>>
    }
    DialogPlanetCancel ~{
        Code=<<<
            DChange(2);
            exit;
        >>>
    }
    DialogTransportPanic ~{
        Code=<<<
            DChange(17);
            exit;
        >>>
    }
}
DialogMsgs ~{
    0 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.111"));    DAdd(14);
            DAdd(16);

        >>>
    }
    1 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.57"));    DAdd(0);

        >>>
    }
    2 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_pla02.114"),"<0>",ShipName(Player())));    DAdd(15);

        >>>
    }
    3 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.60"));    DAdd(1);
            DAdd(2);

        >>>
    }
    4 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.61"));    if(offer_threat) {
              DAdd(3);
            }
            if(offer_money) {
              DAdd(4);
            }
            if(offer_protection) {
              DAdd(5);
            }
            if((offer_threat+offer_money+offer_protection)==0) {
              DAdd(6);
            }

        >>>
    }
    5 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.62"));    DAdd(7);

        >>>
    }
    6 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.63"));    offer_threat=0;
            if(offer_threat) {
              DAdd(3);
            }
            if(offer_money) {
              DAdd(4);
            }
            if(offer_protection) {
              DAdd(5);
            }
            if((offer_threat+offer_money+offer_protection)==0) {
              DAdd(6);
            }

        >>>
    }
    7 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.64"));    offer_threat=0;
            if(offer_threat) {
              DAdd(3);
            }
            if(offer_money) {
              DAdd(4);
            }
            if(offer_protection) {
              DAdd(5);
            }
            if((offer_threat+offer_money+offer_protection)==0) {
              DAdd(6);
            }

        >>>
    }
    8 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.65"));    offer_threat=0;
            if(offer_threat) {
              DAdd(3);
            }
            if(offer_money) {
              DAdd(4);
            }
            if(offer_protection) {
              DAdd(5);
            }
            if((offer_threat+offer_money+offer_protection)==0) {
              DAdd(6);
            }

        >>>
    }
    9 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.66"));    offer_money=0;
            if(offer_threat) {
              DAdd(3);
            }
            if(offer_money) {
              DAdd(4);
            }
            if(offer_protection) {
              DAdd(5);
            }
            if((offer_threat+offer_money+offer_protection)==0) {
              DAdd(6);
            }

        >>>
    }
    10 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.67"));    offer_money=0;
            if(offer_threat) {
              DAdd(3);
            }
            if(offer_money) {
              DAdd(4);
            }
            if(offer_protection) {
              DAdd(5);
            }
            if((offer_threat+offer_money+offer_protection)==0) {
              DAdd(6);
            }

        >>>
    }
    11 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.68"));    if(ShipMoney(Player())>=money_required) {
              DAdd(8);
            }
            DAdd(9);

        >>>
    }
    12 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.69"));    offer_money=0;
            if(offer_threat) {
              DAdd(3);
            }
            if(offer_money) {
              DAdd(4);
            }
            if(offer_protection) {
              DAdd(5);
            }
            if((offer_threat+offer_money+offer_protection)==0) {
              DAdd(6);
            }

        >>>
    }
    13 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.80"));    offer_protection=0;
            if(offer_threat) {
              DAdd(3);
            }
            if(offer_money) {
              DAdd(4);
            }
            if(offer_protection) {
              DAdd(5);
            }
            if((offer_threat+offer_money+offer_protection)==0) {
              DAdd(6);
            }

        >>>
    }
    14 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.81"));    DAdd(10);
            DAdd(11);

        >>>
    }
    15 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.82"));    offer_protection=0;
            if(offer_threat) {
              DAdd(3);
            }
            if(offer_money) {
              DAdd(4);
            }
            if(offer_protection) {
              DAdd(5);
            }
            if((offer_threat+offer_money+offer_protection)==0) {
              DAdd(6);
            }

        >>>
    }
    16 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.83"));    offer_protection=0;
            if(offer_threat) {
              DAdd(3);
            }
            if(offer_money) {
              DAdd(4);
            }
            if(offer_protection) {
              DAdd(5);
            }
            if((offer_threat+offer_money+offer_protection)==0) {
              DAdd(6);
            }

        >>>
    }
    17 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_pla02.84"));    DAdd(12);

        >>>
    }
    18 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_pla02.105"),"<0>",ShipName(quest_ship),"<1>",Name(quest_planet)));    DAdd(13);

        >>>
    }
    19 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_pla02.98"),"<0>",Name(GroupShip(GroupTransports,0)),"<1>",Name(GroupShip(GroupTransports,1)),"<2>",Name(GroupShip(GroupTransports,2)),"<3>",Name(GroupShip(GroupTransports,3)),"<4>",Name(GroupShip(GroupTransports,4)),"<5>",Name(GroupShip(GroupTransports,5)),"<6>",Name(GroupShip(GroupTransports,6))));    DAdd(17);

        >>>
    }
}
DialogAnswers ~{
    0 ~{
        Command=
        Answer=DAnswer(CT("Script.PC_pla02.70"));
        Code=<<<
            DialogStates[num_ship]=1;
            if(DialogTypes[num_ship]==3) {
              if(((ShipGetBad(Player())==CurShip) || (ShipGetBad(CurShip)==Player())) && (HullDamage(CurShip)>=50)) {
                DChange(17);
                exit;
              }
              if(((ShipGetBad(Player())!=CurShip) && (ShipGetBad(CurShip)!=Player())) || (HullDamage(CurShip)<50)) {
                DChange(3);
                exit;
              }
            }
            if(DialogTypes[num_ship]!=3) {
              DChange(3);
              exit;
            }
        >>>
    }
    1 ~{
        Command=
        Answer=DAnswer(CT("Script.PC_pla02.71"));
        Code=<<<
            DChange(4);
            exit;
        >>>
    }
    2 ~{
        Command=exit
        Answer=DAnswer('exit~'+CT("Script.PC_pla02.72"));
        Code=
    }
    3 ~{
        Command=
        Answer=DAnswer(CT("Script.PC_pla02.73"));
        Code=<<<
            if(dtype==0) {
              DChange(5);
              exit;
            }
            if(dtype==1) {
              DChange(6);
              exit;
            }
            if(dtype==2) {
              DChange(7);
              exit;
            }
            if(dtype==3) {
              DChange(8);
              exit;
            }
        >>>
    }
    4 ~{
        Command=
        Answer=DAnswer(CT("Script.PC_pla02.74"));
        Code=<<<
            if(dtype==0) {
              DChange(9);
              exit;
            }
            if(dtype==1) {
              DChange(10);
              exit;
            }
            if(dtype==2) {
              DChange(11);
              exit;
            }
            if(dtype==3) {
              DChange(12);
              exit;
            }
        >>>
    }
    5 ~{
        Command=
        Answer=DAnswer(CT("Script.PC_pla02.75"));
        Code=<<<
            if(dtype==0) {
              DChange(13);
              exit;
            }
            if(dtype==1) {
              DChange(14);
              exit;
            }
            if(dtype==2) {
              DChange(15);
              exit;
            }
            if(dtype==3) {
              DChange(16);
              exit;
            }
        >>>
    }
    6 ~{
        Command=exit
        Answer=DAnswer('exit~'+CT("Script.PC_pla02.76"));
        Code=
    }
    7 ~{
        Command=exit
        Answer=DAnswer('exit~'+CT("Script.PC_pla02.77"));
        Code=<<<
            DialogStates[num_ship]=2;
            ShipOut(CurShip);
            num_deals=num_deals+1;
            TruceBetweenShips(Player(),CurShip);
        >>>
    }
    8 ~{
        Command=exit
        Answer=DAnswer('exit~'+CT("Script.PC_pla02.78"));
        Code=<<<
            DialogStates[num_ship]=2;
            ShipOut(CurShip);
            num_deals=num_deals+1;
            TruceBetweenShips(Player(),CurShip);
            ShipMoney(Player(),ShipMoney(Player())-money_required);
            Sound('Sound.Buy');
        >>>
    }
    9 ~{
        Command=exit
        Answer=DAnswer('exit~'+CT("Script.PC_pla02.79"));
        Code=
    }
    10 ~{
        Command=
        Answer=DAnswer(CT("Script.PC_pla02.86"));
        Code=<<<
            quest_planet=FindPlanet(ShipStar(Player()),'NotNone',0,100);
            planet_owner=PlanetOwner(quest_planet,Rnd(0,1000)%5);
            quest_ship=BuyPirate(quest_planet);
            PlanetOwner(quest_planet,planet_owner);
            quest_planet=FindPlanet(ShipStar(Player()),'NotMaloc,NotPeleng,NotPeople,NotFei,NotGaal,NotPirateClan,NotKling',0,100);
            TransferShip(quest_ship,quest_planet);
            ShipJoin(GroupPirates,quest_ship);
            num_pirates=num_pirates+1;
            PirateIds[num_ship]=Id(quest_ship);
            DChange(18);
            exit;
        >>>
    }
    11 ~{
        Command=exit
        Answer=DAnswer('exit~'+CT("Script.PC_pla02.87"));
        Code=
    }
    12 ~{
        Command=exit
        Answer=DAnswer('exit~'+CT("Script.PC_pla02.88"));
        Code=<<<
            DialogStates[num_ship]=2;
            ShipOut(CurShip);
            num_deals=num_deals+1;
            TruceBetweenShips(Player(),CurShip);
        >>>
    }
    13 ~{
        Command=exit
        Answer=DAnswer('exit~'+CT("Script.PC_pla02.89"));
        Code=<<<
            DialogStates[num_ship]=2;
            OrderFollowShip(Player(),quest_ship);
        >>>
    }
    14 ~{
        Command=
        Answer=DAnswer(CT("Script.PC_pla02.99"));
        Code=<<<
            counter=0;
            while (GroupCount(GroupTransports)<7){
            quest_star=StarNearbyStars(StarNew,counter);
            counter2=0;
            while (counter2<StarPlanets(quest_star)){
            quest_planet=StarPlanets(quest_star,counter2);
            if (PlanetOwner(quest_planet)<5){
            if (quest_planet!=PlanetNew){
            quest_ship=BuyTransport(quest_planet);
            TransportIds[GroupCount(GroupTransports)]=Id(quest_ship);
            DialogTypes[GroupCount(GroupTransports)]=(Rnd(0,1000)%8)/2;
            DialogStates[GroupCount(GroupTransports)]=0;
            PirateIds[GroupCount(GroupTransports)]=0;
            ShipJoin(GroupTransports,quest_ship);
            if (GroupCount(GroupTransports)>6){counter2=StarPlanets(quest_star);}
            }}
            counter2=counter2+1;}
            counter=counter+1;
            if (counter==GalaxyStars()){counter=0;}}
            array_quest_statuses[script_num]=1;
            quest_started=CurTurn();
            Ether(3,'25D5D7BF-E866-417A-B07F-81CD0565E871',Format(CT("Script.PC_pla02.110"),"<0>",Name(PlanetNew),"<1>",Name(StarNew),"<2>",Name(GroupShip(GroupTransports,0)),"<3>",Name(GroupShip(GroupTransports,1)),"<4>",Name(GroupShip(GroupTransports,2)),"<5>",Name(GroupShip(GroupTransports,3)),"<6>",Name(GroupShip(GroupTransports,4)),"<7>",Name(GroupShip(GroupTransports,5)),"<8>",Name(GroupShip(GroupTransports,6)),"<9>",GameDateTxtByTurn(CurTurn()+max_duration)));
            DChange(19);
            exit;
        >>>
    }
    15 ~{
        Command=planet
        Answer=DAnswer('planet~'+CT("Script.PC_pla02.113"));
        Code=
    }
    16 ~{
        Command=planet
        Answer=DAnswer('planet~'+CT("Script.PC_pla02.101"));
        Code=
    }
    17 ~{
        Command=planet
        Answer=DAnswer('planet~'+CT("Script.PC_pla02.102"));
        Code=
    }
}
