Version=6
GlobalVars ~{
    khan_counter ~{
        Type=Integer
        Value=0
    }
    array_script_names ~{
        Type=Unknown
        Value=None
    }
    array_quest_statuses ~{
        Type=Unknown
        Value=None
    }
    array_chosen_planets ~{
        Type=Unknown
        Value=None
    }
    request_dialog ~{
        Type=Integer
        Value=0
    }
    shu_center_destroyed ~{
        Type=Integer
        Value=0
    }
}
GlobalCode=<<<
  if(GetShipPirateRank(Player())<6) {
    GRun();
  }
>>>
LocalVars ~{
    quest_started ~{
        Type=Integer
        Value=0
    }
    points_reached ~{
        Type=Integer
        Value=0
    }
    locations ~{
        Type=Unknown
        Value=None
    }
    quest_star ~{
        Type=Dword
        Value=0
    }
    counter ~{
        Type=Integer
        Value=0
    }
    quest_complete ~{
        Type=Integer
        Value=0
    }
    quest_planet ~{
        Type=Dword
        Value=0
    }
    reward_received ~{
        Type=Integer
        Value=0
    }
    gov_reward ~{
        Type=Integer
        Value=0
    }
    reward_item ~{
        Type=String
        Value=
    }
    mm_choose ~{
        Type=Integer
        Value=0
    }
    pirate_reward ~{
        Type=Integer
        Value=0
    }
    money_reward ~{
        Type=Integer
        Value=0
    }
    array_planet_reqs ~{
        Type=Unknown
        Value=None
    }
    planet_list ~{
        Type=Unknown
        Value=None
    }
    counter2 ~{
        Type=Integer
        Value=0
    }
    temp_star ~{
        Type=Dword
        Value=0
    }
    temp_planet ~{
        Type=Dword
        Value=0
    }
    counter3 ~{
        Type=Integer
        Value=0
    }
    temp_sector ~{
        Type=Dword
        Value=0
    }
    script_num ~{
        Type=Integer
        Value=0
    }
    message_from_gov ~{
        Type=Integer
        Value=0
    }
    gov_talk ~{
        Type=Integer
        Value=0
    }
    gov_planet ~{
        Type=Integer
        Value=0
    }
    req_quests ~{
        Type=Integer
        Value=0
    }
    nearest_rulers_list ~{
        Type=Unknown
        Value=None
    }
    nearest_rulers_text ~{
        Type=Unknown
        Value=None
    }
    quest_item ~{
        Type=Dword
        Value=0
    }
    quests_to_distribute ~{
        Type=Integer
        Value=0
    }
    bonus_num ~{
        Type=Integer
        Value=0
    }
    pirate_hull ~{
        Type=Dword
        Value=0
    }
    item_type ~{
        Type=Integer
        Value=0
    }
    bonus_name ~{
        Type=String
        Value=
    }
    change_loc ~{
        Type=Integer
        Value=0
    }
    block_sys_date ~{
        Type=Integer
        Value=0
    }
    gov_reward_call ~{
        Type=Integer
        Value=0
    }
    message_from_gov2 ~{
        Type=Integer
        Value=0
    }
    hull_name ~{
        Type=String
        Value=
    }
    alt_message ~{
        Type=Integer
        Value=0
    }
    message_win ~{
        Type=Integer
        Value=0
    }
    gov_hull ~{
        Type=Integer
        Value=0
    }
    hull_name1 ~{
        Type=String
        Value=
    }
    hull_name2 ~{
        Type=String
        Value=
    }
    hull_name3 ~{
        Type=String
        Value=
    }
    hull_desc1 ~{
        Type=String
        Value=
    }
    hull_desc2 ~{
        Type=String
        Value=
    }
    hull_desc3 ~{
        Type=String
        Value=
    }
    money_for_rank ~{
        Type=Integer
        Value=1024000
    }
    points ~{
        Type=String
        Value=
    }
    StarNew ~{
        Type=Dword
        Value=0
    }
    PlanetNew ~{
        Type=Dword
        Value=0
    }
    GroupNew ~{
        Type=Dword
        Value=0
    }
    DialogPB3 ~{
        Type=Dword
        Value=0
    }
    DialogPB1 ~{
        Type=Dword
        Value=1
    }
    DialogPlanet ~{
        Type=Dword
        Value=2
    }
    DialogPB4 ~{
        Type=Dword
        Value=3
    }
    DialogPB2 ~{
        Type=Dword
        Value=4
    }
    DialogPlanet2 ~{
        Type=Dword
        Value=5
    }
    DialogPlanetAgent ~{
        Type=Dword
        Value=6
    }
    DialogPB6 ~{
        Type=Dword
        Value=7
    }
}
Constellations=0
Stars ~{
    StarNew ~{
        Constellation=-1
        IsSubspace=False
        NoKling=False
        NoComeKling=False
        StarLinks ~{
        }
        Planets ~{
            PlanetNew ~{
                Race=Maloc,Peleng,People,Fei,Gaal
                Owner=Maloc,Peleng,People,Fei,Gaal
                Economy=Agriculture,Industrial,Mixed
                Government=Anarchy,Dictatorship,Monarchy,Republic,Democracy
                Range=0..100
                Dialog=
            }
        }
        Ships ~{
            0 ~{
                Count=1
                Owner=Maloc,Peleng,People,Fei,Gaal
                Type=Ranger,Warrior,Pirate,Transport,Liner,Diplomat
                IsPlayer=True
                Speed=0..10000
                Weapon=Undef
                CargoHook=0
                EmptySpace=0
                Rating=0..1000
                Status ~{
                    Trader=0..100
                    Warrior=0..100
                    Pirate=0..100
                }
                Score=0..1000000
                Strength=0.0..0.0
                Ruins=
            }
        }
    }
}
Places ~{
}
Items ~{
}
Groups ~{
    GroupNew ~{
        Planet=PlanetNew
        State=0(StateNew)
        Owner=Maloc,Peleng,People,Fei,Gaal
        Type=Ranger,Warrior,Pirate,Transport,Liner,Diplomat
        Count=1..1
        Speed=100..10000
        Weapon=Undef
        CargoHook=0
        EmptySpace=0
        Friendship=Free
        AddPlayer=True
        Rating=0..1000
        Score=0..1000000
        Status ~{
            Trader=0..100
            Warrior=0..100
            Pirate=0..100
        }
        SearchDist=10000
        Dialog=
        Strength=0.0..0.0
        Ruins=
    }
}
GroupLinks ~{
}
InitCode=<<<
  array_script_names=newarray(1);
  array_script_names[0]='dummy';
  array_planet_reqs=newarray(1);
  array_planet_reqs[0]=0;
  array_chosen_planets=newarray(1);
  array_chosen_planets[0]=0;
  array_quest_statuses=newarray(1);
  array_quest_statuses[0]=0;
  planet_list=newarray(1);
  planet_list[0]=0;
  //ArrayAdd(array_script_names,'PC_pla01');
  //ArrayAdd(array_planet_reqs,5)
  //replacement quest;
  ArrayAdd(array_script_names,'PC_pla02');
  ArrayAdd(array_planet_reqs,5);
  ArrayAdd(array_script_names,'PC_pla03');
  ArrayAdd(array_planet_reqs,5);
  ArrayAdd(array_script_names,'PC_pla04');
  ArrayAdd(array_planet_reqs,5);
  ArrayAdd(array_script_names,'PC_pla05');
  ArrayAdd(array_planet_reqs,5);
  ArrayAdd(array_script_names,'PC_pla06');
  ArrayAdd(array_planet_reqs,5);
  ArrayAdd(array_script_names,'PC_pla07');
  ArrayAdd(array_planet_reqs,1);
  ArrayAdd(array_script_names,'PC_pla08');
  ArrayAdd(array_planet_reqs,0);
  ArrayAdd(array_script_names,'PC_pla09');
  ArrayAdd(array_planet_reqs,5);
  ArrayAdd(array_script_names,'PC_pla10');
  ArrayAdd(array_planet_reqs,1);
  ArrayAdd(array_script_names,'PC_pla11');
  ArrayAdd(array_planet_reqs,5);
  ArrayAdd(array_script_names,'PC_pla12');
  ArrayAdd(array_planet_reqs,5);
  ArrayAdd(array_script_names,'PC_pla13');
  ArrayAdd(array_planet_reqs,5);
  ArrayAdd(array_script_names,'PC_pla14');
  ArrayAdd(array_planet_reqs,5);
  ArrayAdd(array_script_names,'PC_pla15');
  ArrayAdd(array_planet_reqs,5);
  ArrayAdd(array_script_names,'PC_pla16');
  ArrayAdd(array_planet_reqs,2);
  ArrayAdd(array_script_names,'PC_pla17');
  ArrayAdd(array_planet_reqs,5);
  ArrayAdd(array_script_names,'PC_pla18');
  ArrayAdd(array_planet_reqs,5);
  ArrayAdd(array_script_names,'PC_pla19');
  ArrayAdd(array_planet_reqs,5);
  ArrayAdd(array_script_names,'PC_pla20');
  ArrayAdd(array_planet_reqs,5);
  ArrayAdd(array_script_names,'PC_pla21');
  ArrayAdd(array_planet_reqs,5);
  ArrayDelete(array_script_names,0);//
  ArrayDelete(array_planet_reqs,0);//
  while (ArrayDim(array_script_names)>ArrayDim(array_chosen_planets)){
  ArrayAdd(array_chosen_planets,0);
  ArrayAdd(array_quest_statuses,0);}
  quests_to_distribute=ArrayDim(array_script_names);
  ArrayRandomize(quests_to_distribute,array_script_names,array_planet_reqs);
  counter=0;
  while (counter<(GalaxySectors()-1)){//excluding pirate sector
  temp_sector=GalaxySectors(counter);
  counter2=0;
  while (counter2<ConStars(temp_sector)){
  temp_star=ConStar(temp_sector,counter2);
  counter3=0;
  while (counter3<StarPlanets(temp_star)){
  temp_planet=StarPlanets(temp_star,counter3);
  if (PlanetOwner(temp_planet)!=None){ArrayAdd(planet_list,temp_planet);
  counter3=StarPlanets(temp_star);
  counter2=ConStars(temp_sector);
  }//only sector capital planets get quests
  counter3=counter3+1;}
  counter2=counter2+1;}
  counter=counter+1;}
  ArrayDelete(planet_list,0);//remove initial 0
  ArrayRandomize(ArrayDim(planet_list),planet_list);
  if (ArrayDim(planet_list)<quests_to_distribute){quests_to_distribute=ArrayDim(planet_list);}
  counter3=0;
  while (counter3<5){
  counter=0;
  while (counter<quests_to_distribute){
  if (array_planet_reqs[counter]==counter3){
  counter2=ArrayDim(planet_list)-1;
  while (counter2>=0){
  if (PlanetRace(planet_list[counter2])==counter3){array_chosen_planets[counter]=Id(planet_list[counter2]); 
  ArrayDelete(planet_list,counter2);
  counter2=0;}
  counter2=counter2-1;}
  }
  counter=counter+1;}
  counter3=counter3+1;}
  counter=0;
  while (counter<quests_to_distribute){
  if (array_chosen_planets[counter]==0){
  //in case some race-specific script failed to get planet, just give it anything
  counter2=ArrayDim(planet_list)-1;
  array_chosen_planets[counter]=Id(planet_list[counter2]); 
  if (ArrayDim(planet_list)>1){//SFT('check2');
  ArrayDelete(planet_list,counter2);}}
  //dont remove last element, cycle stops then anyway
  counter=counter+1;}
  locations=newarray(1);
  req_quests=1+GalaxyDiffLevels()/50;
  nearest_rulers_list=newarray(1);
  nearest_rulers_text=newarray(4);
>>>
TurnCode=<<<
  if(!points_reached) {
    if(ShipPirateRankPoints(Player())>=ShipNextPirateRankPoints(Player())) {
      if(GetShipPirateRank(Player())==5) {
        points_reached=1;
        if(!quest_started) {
          Ether(0,'DAC3B7C2-FD9D-4EEC-97B9-6FFB223074A8',CT("Script.PC_part6.157"));
        }
      }
    }
  }
  if(quest_started) {
    if(!message_win) {
      if(!khan_counter) {
        Ether(3,'C9F3FDAA-0799-4A09-A2ED-4C6FF30D59EE',Format(CT("Script.PC_part6.156"),"<0>",req_quests));
      }
      if(khan_counter) {
        if(khan_counter<req_quests) {
          Ether(3,'C9F3FDAA-0799-4A09-A2ED-4C6FF30D59EE',Format(CT("Script.PC_part6.155"),"<0>",req_quests,"<1>",khan_counter));
        }
        if(khan_counter>=req_quests) {
          Ether(3,'C9F3FDAA-0799-4A09-A2ED-4C6FF30D59EE',Format(CT("Script.PC_part6.154"),"<0>",req_quests));
        }
      }
    }
  }
  if(quest_started) {
    if(agent_counter>2) {
      if(!message_from_gov) {
        if(ShipInNormalSpace(Player())) {
          gov_planet=0;
          counter=BuildListOfQuestPossibleLocations(locations,ShipStar(Player()),1,255);
          if (counter){
          counter=StarListToTransitPlanetList(locations,ShipStar(Player()),ShipStar(Player()),60,150,200,100,90,75,array_chosen_planets,0);}
          if (counter){gov_planet=Id(locations[0]);}
          if(gov_planet) {
            message_from_gov=1;
            Ether(0,'65ADAB40-E4E9-4EC0-A86A-2D89D2B9749A',Format(CT("Script.PC_part6.174"),"<0>",Name(PlanetToStar(IdToPlanet(gov_planet))),"<1>",Name(IdToPlanet(gov_planet))));
          }
        }
      }
      if(message_from_gov) {
        if(!gov_talk) {
          if(!quest_complete) {
            if(change_loc) {
              gov_planet=0;
              counter=BuildListOfQuestPossibleLocations(locations,ShipStar(Player()),1,255);
              if (counter){
              counter=StarListToTransitPlanetList(locations,ShipStar(Player()),ShipStar(Player()),60,150,200,100,90,75,array_chosen_planets,0);}
              if (counter){gov_planet=Id(locations[0]);}
              if(gov_planet) {
                change_loc=0;
                alt_message=1;
                if (!NoComeKlingToStar(PlanetToStar(IdToPlanet(gov_planet)))){
                block_sys_date=CurTurn();
                NoComeKlingToStar(PlanetToStar(IdToPlanet(gov_planet)),1);}
                Ether(0,'CB9A5D11-4936-4470-BF8C-D6C30FFDC372',Format(CT("Script.PC_part6.153"),"<0>",Name(IdToPlanet(gov_planet)),"<1>",Name(PlanetToStar(IdToPlanet(gov_planet)))));
              }
            }
            if(!change_loc) {
              if(PlanetOwner(IdToPlanet(gov_planet))<Kling) {
                if(!ShipInNormalSpace(Player())) {
                  if(alt_message) {
                    Ether(0,'CB9A5D11-4936-4470-BF8C-D6C30FFDC372',Format(CT("Script.PC_part6.153"),"<0>",Name(IdToPlanet(gov_planet)),"<1>",Name(PlanetToStar(IdToPlanet(gov_planet)))));
                  }
                  if(!alt_message) {
                    Ether(0,'65ADAB40-E4E9-4EC0-A86A-2D89D2B9749A',Format(CT("Script.PC_part6.174"),"<0>",Name(PlanetToStar(IdToPlanet(gov_planet))),"<1>",Name(IdToPlanet(gov_planet))));
                  }
                }
              }
              if(PlanetOwner(IdToPlanet(gov_planet))>=Kling) {
                Ether(0,'B37AB8FC-59AB-4E8F-81A6-6DAA7CBADA10',Format(CT("Script.PC_part6.120"),"<0>",Name(PlanetToStar(IdToPlanet(gov_planet)))));
                change_loc=1;
                gov_planet=0;
              }
            }
          }
        }
      }
    }
  }
  if(block_sys_date) {
    if((block_sys_date+30)<CurTurn()) {
      block_sys_date=0;
      NoComeKlingToStar(PlanetToStar(IdToPlanet(gov_planet)),0);
    }
  }
  if(gov_reward_call) {
    if(message_from_gov2) {
      if(!gov_reward) {
        if(change_loc) {
          gov_planet=0;
          counter=BuildListOfQuestPossibleLocations(locations,ShipStar(Player()),1,255);
          if (counter){
          counter=StarListToTransitPlanetList(locations,ShipStar(Player()),ShipStar(Player()),60,150,200,100,90,75,array_chosen_planets,0);}
          if (counter){gov_planet=Id(locations[0]);}
          if(gov_planet) {
            change_loc=0;
            alt_message=1;
            if (!NoComeKlingToStar(PlanetToStar(IdToPlanet(gov_planet)))){
            block_sys_date=CurTurn();
            NoComeKlingToStar(PlanetToStar(IdToPlanet(gov_planet)),1);}
            Ether(0,'4B823A37-EB73-4511-9FB3-8E4F4C073E51',Format(CT("Script.PC_part6.121"),"<0>",Name(PlanetToStar(IdToPlanet(gov_planet))),"<1>",Name(IdToPlanet(gov_planet))));
          }
        }
        if(!change_loc) {
          if(PlanetOwner(IdToPlanet(gov_planet))<Kling) {
            if(!ShipInNormalSpace(Player())) {
              if(alt_message) {
                Ether(0,'4B823A37-EB73-4511-9FB3-8E4F4C073E51',Format(CT("Script.PC_part6.121"),"<0>",Name(PlanetToStar(IdToPlanet(gov_planet))),"<1>",Name(IdToPlanet(gov_planet))));
              }
              if(!alt_message) {
                Ether(0,'B6B013F3-359C-429D-99DF-B026DDA72E23',Format(CT("Script.PC_part6.89"),"<0>",Name(IdToPlanet(gov_planet)),"<1>",Name(PlanetToStar(IdToPlanet(gov_planet)))));
              }
            }
          }
          if(PlanetOwner(IdToPlanet(gov_planet))>=Kling) {
            Ether(0,'69CEDAED-E4EF-4628-B5CC-F6AA5D0553B7',Format(CT("Script.PC_part6.120"),"<0>",Name(PlanetToStar(IdToPlanet(gov_planet)))));
            change_loc=1;
            gov_planet=0;
          }
        }
      }
    }
    if(!message_from_gov2) {
      gov_planet=0;
      counter=BuildListOfQuestPossibleLocations(locations,ShipStar(Player()),1,255);
      if (counter){
      counter=StarListToTransitPlanetList(locations,ShipStar(Player()),ShipStar(Player()),70,150,200,100,90,75,array_chosen_planets,0);}
      if (counter){gov_planet=Id(locations[0]);}
      if(gov_planet) {
        message_from_gov2=1;
        alt_message=0;
        Ether(0,'B6B013F3-359C-429D-99DF-B026DDA72E23',Format(CT("Script.PC_part6.89"),"<0>",Name(IdToPlanet(gov_planet)),"<1>",Name(PlanetToStar(IdToPlanet(gov_planet)))));
      }
    }
  }
  if(quest_complete) {
    if(agent_counter>2) {
      if((gov_reward && gov_hull) || CoalitionDefeated()) {
        ShipOut(Player());
        if (block_sys_date){block_sys_date=0;
        NoComeKlingToStar(PlanetToStar(IdToPlanet(gov_planet)),0);}
      }
    }
    if(agent_counter<3) {
      ShipOut(Player());
      if (block_sys_date){block_sys_date=0;
      NoComeKlingToStar(PlanetToStar(IdToPlanet(gov_planet)),0);}
    }
  }
>>>
DialogBegin=<<<
  if(GetShipRuins(Player())>0) {
    if(ShipType(GetShipRuins(Player()))=='PB') {
      if(ShipInPirateClan(Player())) {
        if(GetShipPirateRank(Player())==5) {
          if(ShipPirateRankPoints(Player())<ShipNextPirateRankPoints(Player())) {
            AddDialogInject('DialogPB1','',CT("Script.PC_part6.101"),1);
          }
          if(ShipPirateRankPoints(Player())>=ShipNextPirateRankPoints(Player())) {
            if(!quest_complete) {
              if(!quest_started && !CoalitionDefeated()) {
                GotoGov(1);
                AddDialogOverride('DialogPB3',10);
              }
              if(quest_started) {
                if((khan_counter<req_quests) && !CoalitionDefeated()) {
                  AddDialogInject('DialogPB2','',CT("Script.PC_part6.100"),1);
                }
                if((khan_counter>=req_quests) || CoalitionDefeated()) {
                  GotoGov(1);
                  AddDialogOverride('DialogPB4',10);
                  if(!message_win) {
                    message_win=1;
                    Ether(4,'C9F3FDAA-0799-4A09-A2ED-4C6FF30D59EE',Format(CT("Script.PC_part6.154"),"<0>",req_quests));
                  }
                }
              }
            }
            if(CoalitionDefeated() && !quest_started) {
              money_for_rank=1024000;
              AddDialogInject('DialogPB6','',CT("Script.PC_part6.161"),1);
            }
          }
        }
      }
    }
  }
  if(GetShipPlanet(Player())>0) {
    if(GetShipPirateRank(Player())>5) {
      if(Id(GetShipPlanet(Player()))==gov_planet) {
        if((agent_counter>2) && quest_complete && !gov_hull) {
          AddDialogOverride('DialogPlanetAgent',10);
        }
      }
    }
    if(GetShipPirateRank(Player())==5) {
      if(Id(GetShipPlanet(Player()))==gov_planet) {
        if((agent_counter>2) && !quest_complete && quest_started && !gov_talk) {
          AddDialogOverride('DialogPlanet2',10);
        }
      }
      if(quest_started && (khan_counter<req_quests)) {
        counter=0;
        while(counter<ArrayDim(array_script_names)) {
          if (Id(GetShipPlanet(Player()))==array_chosen_planets[counter]){
          if(!array_quest_statuses[counter]){
          script_num=counter;
          AddDialogInject('DialogPlanet','',CT("Script.PC_part6.99"),1);}}
          counter=counter+1;
        }
      }
    }
  }
>>>
States ~{
    StateNew ~{
        Type=None
        Attack ~{
        }
        TakeItem=
        TakeAll=False
        OutMsg=
        InMsg=
        Ether=
        Code=
    }
}
Dialogs ~{
    DialogPB3 ~{
        Code=<<<
            GotoGov(2);
            DChange(0);
            exit;
        >>>
    }
    DialogPB1 ~{
        Code=<<<
            points='<clrEnd>'+CT('FormRuins.PB.RankPoints.RankPoints');
            DChange(1);
            exit;
        >>>
    }
    DialogPlanet ~{
        Code=<<<
            if(!StarBattle(ShipStar(Player()))) {
              quest_planet=IdToPlanet(array_chosen_planets[script_num]);
              quest_star=PlanetToStar(quest_planet);
              ScriptRun(quest_star,quest_planet,array_script_names[script_num]);
              request_dialog=1;
            }
            if(StarBattle(ShipStar(Player()))) {
              DChange(16);
              exit;
            }
        >>>
    }
    DialogPB4 ~{
        Code=<<<
            if(khan_counter<req_quests) {
              DChange(20);
              exit;
            }
            if(khan_counter>=req_quests) {
              GotoGov(2);
              hull_name1=CT("Script.PC_part6.136");
              hull_name2=CT("Script.PC_part6.135");
              hull_name3=CT("Script.PC_part6.125");
              hull_desc1=BonusText(FindBonusByName(hull_name1))+'<color=0,0,0>';
              hull_desc1='</color>'+DeleteTags(hull_desc1)+'<color=0,0,0>';
              hull_desc2=BonusText(FindBonusByName(hull_name2))+'<color=0,0,0>';
              hull_desc2='</color>'+DeleteTags(hull_desc2)+'<color=0,0,0>';
              hull_desc3=BonusText(FindBonusByName(hull_name3))+'<color=0,0,0>';
              hull_desc3='</color>'+DeleteTags(hull_desc3)+'<color=0,0,0>';
              if(!mm_choose) {
                if(agent_counter<3) {
                  if (!pirate_reward){
                  item_type=Rnd(0,1000)%ArrayDim(reward_eq_size);
                  bonus_name=pirate_mod[item_type];
                  bonus_name=bonus_name+' I';
                  if (GalaxyTechLevel()>2){bonus_name=bonus_name+'I';}
                  if (GalaxyTechLevel()>4){bonus_name=bonus_name+'I';}
                  if (FindBonusByName(bonus_name)>-1){
                  quest_item=CreateEquipmentWithSpecial(
                    FindBonusByName(bonus_name),
                    reward_eq_size[item_type],
                    GalaxyTechLevel(),
                    ShipOwner(GetShipRuins(Player())));
                  } else quest_item=CreateEquipment(Rnd(t_FuelTanks,t_DefGenerator),20,GalaxyTechLevel(),ShipOwner(Player()));
                  reward_item=Format(ItemFullName(quest_item),'<color=255,167,84>','');
                  if (ArrayDim(reward_eq_size)>1){
                  ArrayDelete(reward_eq_size,item_type);
                  ArrayDelete(pirate_mod,item_type);
                  ArrayDelete(gov_mod,item_type);
                  }
                  AddItemToShip(Player(),quest_item);}
                  pirate_reward=1;
                  DChange(6);
                  exit;
                }
                if(agent_counter>2) {
                  DChange(7);
                  exit;
                }
              }
              if(mm_choose) {
                DChange(8);
                exit;
              }
            }
        >>>
    }
    DialogPB2 ~{
        Code=<<<
            ArrayClear(nearest_rulers_list);
            counter=0;
            while (counter<GalaxyStars()){
            quest_star=StarNearbyStars(ShipStar(Player()),counter);
            counter2=0;
            while (counter2<StarPlanets(quest_star)){
            quest_planet=StarPlanets(quest_star,counter2);
            counter3=1;
            while (counter3<ArrayDim(array_chosen_planets)){
            if (array_chosen_planets[counter3]==Id(quest_planet)){
            if (array_quest_statuses[counter3]<2){
            ArrayAdd(nearest_rulers_list,quest_planet);}}
            counter3=counter3+1;}
            counter2=counter2+1;}
            counter=counter+1;}
            if(ArrayDim(nearest_rulers_list)>1) {
              nearest_rulers_text[1]=Name(nearest_rulers_list[1])+' ('+Name(PlanetToStar(nearest_rulers_list[1]))+')';
              nearest_rulers_text[2]='';
              nearest_rulers_text[3]='';
              if (ArrayDim(nearest_rulers_list)>2){nearest_rulers_text[2]=Name(nearest_rulers_list[2])+' ('+Name(PlanetToStar(nearest_rulers_list[2]))+')';}
              if (ArrayDim(nearest_rulers_list)>3){nearest_rulers_text[3]=Name(nearest_rulers_list[3])+' ('+Name(PlanetToStar(nearest_rulers_list[3]))+')';}
              DChange(5);
              exit;
            }
            if(ArrayDim(nearest_rulers_list)==1) {
              DChange(15);
              exit;
            }
        >>>
    }
    DialogPlanet2 ~{
        Code=<<<
            DChange(10);
            exit;
        >>>
    }
    DialogPlanetAgent ~{
        Code=<<<
            if (!gov_reward){
            item_type=Rnd(0,1000)%ArrayDim(reward_eq_size);
            bonus_name=gov_mod[item_type];
            bonus_name=bonus_name+' I';
            if (GalaxyTechLevel()>2){bonus_name=bonus_name+'I';}
            if (GalaxyTechLevel()>4){bonus_name=bonus_name+'I';}
            if (FindBonusByName(bonus_name)>-1){
            quest_item=CreateEquipmentWithSpecial(
              FindBonusByName(bonus_name),
              reward_eq_size[item_type],
              GalaxyTechLevel(),
              PlanetOwner(GetShipPlanet(Player())));
            } else quest_item=CreateEquipment(Rnd(t_FuelTanks,t_DefGenerator),20,GalaxyTechLevel(),ShipOwner(Player()));
            reward_item=Format(ItemFullName(quest_item),'<color=255,167,84>','');
            AddItemToShip(Player(),quest_item);
            if (ArrayDim(reward_eq_size)>1){
            ArrayDelete(reward_eq_size,item_type);
            ArrayDelete(pirate_mod,item_type);
            ArrayDelete(gov_mod,item_type);}
            }
            gov_reward=1;
            hull_name1=CT("Script.PC_part6.158");
            hull_name2=CT("Script.PC_part6.129");
            hull_name3=CT("Script.PC_part6.128");
            hull_desc1=BonusText(FindBonusByName(hull_name1));
            hull_desc1='</color>'+DeleteTags(hull_desc1)+'<color=0,0,0>';
            hull_desc2=BonusText(FindBonusByName(hull_name2));
            hull_desc2='</color>'+DeleteTags(hull_desc2)+'<color=0,0,0>';
            hull_desc3=BonusText(FindBonusByName(hull_name3));
            hull_desc3='</color>'+DeleteTags(hull_desc3)+'<color=0,0,0>';
            if(!shu_center_destroyed) {
              DChange(13);
              exit;
            }
            if(shu_center_destroyed) {
              DChange(17);
              exit;
            }
        >>>
    }
    DialogPB6 ~{
        Code=<<<
            DChange(18);
            exit;
        >>>
    }
}
DialogMsgs ~{
    0 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_part6.48"),"<0>",ShipName(Player())));    DAdd(1);

        >>>
    }
    1 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_part6.176"),"<0>",ShipNextPirateRankPoints(Player()),"<1>",ShipPirateRankPoints(Player()),"<2>",points));    DAdd(17);

        >>>
    }
    2 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_part6.56"));    DAdd(0);

        >>>
    }
    3 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_part6.49"),"<0>",ShipName(Player())));    DAdd(2);

        >>>
    }
    4 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_part6.145"),"<0>",req_quests,"<1>",nearest_rulers_text[1],"<2>",nearest_rulers_text[2],"<3>",nearest_rulers_text[3],"<4>",ShipName(Player())));    DAdd(3);

        >>>
    }
    5 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_part6.91"),"<0>",req_quests-khan_counter,"<1>",nearest_rulers_text[1],"<2>",nearest_rulers_text[2],"<3>",nearest_rulers_text[3]));    DAdd(4);

        >>>
    }
    6 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_part6.159"),"<0>",reward_item));    DAdd(5);

        >>>
    }
    7 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_part6.160"));    DAdd(6);

        >>>
    }
    8 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_part6.131"),"<0>",hull_name1,"<1>",hull_desc1,"<2>",hull_name2,"<3>",hull_desc2,"<4>",hull_name3,"<5>",hull_desc3));    mm_choose=1;
            DAdd(7);
            DAdd(8);
            DAdd(9);

        >>>
    }
    9 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_part6.132"),"<0>",hull_name1,"<1>",hull_desc1,"<2>",hull_name2,"<3>",hull_desc2,"<4>",hull_name3,"<5>",hull_desc3));    mm_choose=1;
            DAdd(7);
            DAdd(8);
            DAdd(9);

        >>>
    }
    10 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_part6.76"),"<0>",ShipName(Player())));    DAdd(10);
            DAdd(11);

        >>>
    }
    11 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_part6.146"),"<0>",ShipName(Player())));    DAdd(12);

        >>>
    }
    12 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_part6.147"));    DAdd(13);

        >>>
    }
    13 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_part6.149"),"<0>",reward_item,"<1>",hull_name1,"<2>",hull_desc1,"<3>",hull_name2,"<4>",hull_desc2,"<5>",hull_name3,"<6>",hull_desc3));    DAdd(19);
            DAdd(20);
            DAdd(21);

        >>>
    }
    14 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_part6.148"));    DAdd(14);

        >>>
    }
    15 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_part6.92"),"<0>",ShipName(Player())));    DAdd(15);
            DAdd(16);

        >>>
    }
    16 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_part6.102"));    DAdd(18);

        >>>
    }
    17 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_part6.151"),"<0>",reward_item,"<1>",hull_name1,"<2>",hull_desc1,"<3>",hull_name2,"<4>",hull_desc2,"<5>",hull_name3,"<6>",hull_desc3));    DAdd(19);
            DAdd(20);
            DAdd(21);

        >>>
    }
    18 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_part6.173"),"<0>",ShipName(Player()),"<1>",money_for_rank));    if(ShipMoney(Player())>=money_for_rank) {
              DAdd(23);
            }
            DAdd(22);

        >>>
    }
    19 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_part6.169"),"<0>",ShipName(Player())));    DAdd(24);

        >>>
    }
    20 ~{
        Name=
        Code=<<<
            DText(CT("Script.PC_part6.164"));    while (GetShipPirateRank(Player())<6){RaisePirateRank(Player());}
            if (block_sys_date){block_sys_date=0;
            NoComeKlingToStar(PlanetToStar(IdToPlanet(gov_planet)),0);}
            ShipOut(Player());
            DAdd(25);

        >>>
    }
}
DialogAnswers ~{
    0 ~{
        Command=restart
        Answer=DAnswer('restart~'+CT("Script.PC_part6.103"));
        Code=
    }
    1 ~{
        Command=
        Answer=DAnswer(CT("Script.PC_part6.53"));
        Code=<<<
            DChange(3);
            exit;
        >>>
    }
    2 ~{
        Command=
        Answer=DAnswer(CT("Script.PC_part6.54"));
        Code=<<<
            ArrayClear(nearest_rulers_list);
            counter=0;
            while (counter<GalaxyStars()){
            quest_star=StarNearbyStars(ShipStar(Player()),counter);
            counter2=0;
            while (counter2<StarPlanets(quest_star)){
            quest_planet=StarPlanets(quest_star,counter2);
            counter3=1;
            while (counter3<ArrayDim(array_chosen_planets)){
            if (array_chosen_planets[counter3]==Id(quest_planet)){
            ArrayAdd(nearest_rulers_list,quest_planet);}
            counter3=counter3+1;}
            counter2=counter2+1;}
            counter=counter+1;}
            nearest_rulers_text[1]=Name(nearest_rulers_list[1])+' ('+Name(PlanetToStar(nearest_rulers_list[1]))+')';
            nearest_rulers_text[2]=Name(nearest_rulers_list[2])+' ('+Name(PlanetToStar(nearest_rulers_list[2]))+')';
            nearest_rulers_text[3]=Name(nearest_rulers_list[3])+' ('+Name(PlanetToStar(nearest_rulers_list[3]))+')';
            DChange(4);
            exit;
        >>>
    }
    3 ~{
        Command=hangar
        Answer=DAnswer('hangar~'+CT("Script.PC_part6.110"));
        Code=<<<
            quest_started=1;
            GotoGov(0);
            Ether(3,'C9F3FDAA-0799-4A09-A2ED-4C6FF30D59EE',Format(CT("Script.PC_part6.156"),"<0>",req_quests));
        >>>
    }
    4 ~{
        Command=restart
        Answer=DAnswer('restart~'+CT("Script.PC_part6.93"));
        Code=
    }
    5 ~{
        Command=
        Answer=DAnswer(CT("Script.PC_part6.61"));
        Code=<<<
            DChange(8);
            exit;
        >>>
    }
    6 ~{
        Command=
        Answer=DAnswer(CT("Script.PC_part6.62"));
        Code=<<<
            DChange(9);
            exit;
        >>>
    }
    7 ~{
        Command=
        Answer=DAnswer(Format(CT("Script.PC_part6.134"),"<0>",hull_name1));
        Code=<<<
            hull_name=hull_name1;
            bonus_num=FindBonusByName(hull_name);
            pirate_hull=CreateHull(2,1000,8,ShipOwner(GetShipRuins(Player())));
            AddItemToStorage(GetShipRuins(Player()),pirate_hull);
            if (bonus_num>-1){SpecialToEquipment(bonus_num,pirate_hull);}
            while (GetShipPirateRank(Player())<6){RaisePirateRank(Player());}
            reward_received=1;
            quest_complete=1;
            GotoGov(0);
            if((agent_counter>2) && !CoalitionDefeated()) {
              gov_reward_call=1;
              if (block_sys_date){block_sys_date=0;
              NoComeKlingToStar(PlanetToStar(IdToPlanet(gov_planet)),0);}
              gov_planet=0;
              counter=BuildListOfQuestPossibleLocations(locations,ShipStar(Player()),1,255);
              if (counter){
              counter=StarListToTransitPlanetList(locations,ShipStar(Player()),ShipStar(Player()),70,150,200,100,90,75,array_chosen_planets,0);}
              if (counter){gov_planet=Id(locations[0]);}
              if(gov_planet) {
                message_from_gov2=1;
                alt_message=0;
                Ether(0,'B6B013F3-359C-429D-99DF-B026DDA72E23',Format(CT("Script.PC_part6.89"),"<0>",Name(IdToPlanet(gov_planet)),"<1>",Name(PlanetToStar(IdToPlanet(gov_planet)))));
              }
            }
            DChange(2);
            exit;
        >>>
    }
    8 ~{
        Command=
        Answer=DAnswer(Format(CT("Script.PC_part6.134"),"<0>",hull_name2));
        Code=<<<
            hull_name=hull_name2;
            bonus_num=FindBonusByName(hull_name);
            pirate_hull=CreateHull(2,1000,8,ShipOwner(GetShipRuins(Player())));
            AddItemToStorage(GetShipRuins(Player()),pirate_hull);
            if (bonus_num>-1){SpecialToEquipment(bonus_num,pirate_hull);}
            while (GetShipPirateRank(Player())<6){RaisePirateRank(Player());}
            reward_received=1;
            quest_complete=1;
            GotoGov(0);
            if((agent_counter>2) && !CoalitionDefeated()) {
              gov_reward_call=1;
              if (block_sys_date){block_sys_date=0;
              NoComeKlingToStar(PlanetToStar(IdToPlanet(gov_planet)),0);}
              gov_planet=0;
              counter=BuildListOfQuestPossibleLocations(locations,ShipStar(Player()),1,255);
              if (counter){
              counter=StarListToTransitPlanetList(locations,ShipStar(Player()),ShipStar(Player()),70,150,200,100,90,75,array_chosen_planets,0);}
              if (counter){gov_planet=Id(locations[0]);}
              if(gov_planet) {
                message_from_gov2=1;
                alt_message=0;
                Ether(0,'B6B013F3-359C-429D-99DF-B026DDA72E23',Format(CT("Script.PC_part6.89"),"<0>",Name(IdToPlanet(gov_planet)),"<1>",Name(PlanetToStar(IdToPlanet(gov_planet)))));
              }
            }
            DChange(2);
            exit;
        >>>
    }
    9 ~{
        Command=
        Answer=DAnswer(Format(CT("Script.PC_part6.134"),"<0>",hull_name3));
        Code=<<<
            hull_name=hull_name3;
            bonus_num=FindBonusByName(hull_name);
            pirate_hull=CreateHull(2,1000,8,ShipOwner(GetShipRuins(Player())));
            AddItemToStorage(GetShipRuins(Player()),pirate_hull);
            if (bonus_num>-1){SpecialToEquipment(bonus_num,pirate_hull);}
            while (GetShipPirateRank(Player())<6){RaisePirateRank(Player());}
            reward_received=1;
            quest_complete=1;
            GotoGov(0);
            if((agent_counter>2) && !CoalitionDefeated()) {
              gov_reward_call=1;
              if (block_sys_date){block_sys_date=0;
              NoComeKlingToStar(PlanetToStar(IdToPlanet(gov_planet)),0);}
              gov_planet=0;
              counter=BuildListOfQuestPossibleLocations(locations,ShipStar(Player()),1,255);
              if (counter){
              counter=StarListToTransitPlanetList(locations,ShipStar(Player()),ShipStar(Player()),70,150,200,100,90,75,array_chosen_planets,0);}
              if (counter){gov_planet=Id(locations[0]);}
              if(gov_planet) {
                message_from_gov2=1;
                alt_message=0;
                Ether(0,'B6B013F3-359C-429D-99DF-B026DDA72E23',Format(CT("Script.PC_part6.89"),"<0>",Name(IdToPlanet(gov_planet)),"<1>",Name(PlanetToStar(IdToPlanet(gov_planet)))));
              }
            }
            DChange(2);
            exit;
        >>>
    }
    10 ~{
        Command=
        Answer=DAnswer(CT("Script.PC_part6.72"));
        Code=<<<
            DChange(11);
            exit;
        >>>
    }
    11 ~{
        Command=
        Answer=DAnswer(CT("Script.PC_part6.73"));
        Code=<<<
            DChange(12);
            exit;
        >>>
    }
    12 ~{
        Command=planet
        Answer=DAnswer('planet~'+CT("Script.PC_part6.86"));
        Code=<<<
            gov_talk=1;
        >>>
    }
    13 ~{
        Command=planet
        Answer=DAnswer('planet~'+CT("Script.PC_part6.87"));
        Code=<<<
            gov_talk=1;
        >>>
    }
    14 ~{
        Command=planet
        Answer=DAnswer('planet~'+CT("Script.PC_part6.87"));
        Code=
    }
    15 ~{
        Command=restart
        Answer=DAnswer('restart~'+CT("Script.PC_part6.94"));
        Code=
    }
    16 ~{
        Command=restart
        Answer=DAnswer('restart~'+CT("Script.PC_part6.95"));
        Code=<<<
            PirateWin(4);
            EndGame(8);
        >>>
    }
    17 ~{
        Command=restart
        Answer=DAnswer('restart~'+CT("Script.PC_part6.93"));
        Code=
    }
    18 ~{
        Command=planet
        Answer=DAnswer('planet~'+CT("Script.PC_part6.104"));
        Code=
    }
    19 ~{
        Command=
        Answer=DAnswer(Format(CT("Script.PC_part6.134"),"<0>",hull_name1));
        Code=<<<
            hull_name=hull_name1;
            bonus_num=FindBonusByName(hull_name);
            pirate_hull=CreateHull(2,1000,8,PlanetRace(GetShipPlanet(Player())));
            AddItemToStorage(GetShipPlanet(Player()),pirate_hull);
            if (bonus_num>-1){SpecialToEquipment(bonus_num,pirate_hull);}
            gov_hull=1;
            DChange(14);
            exit;
        >>>
    }
    20 ~{
        Command=
        Answer=DAnswer(Format(CT("Script.PC_part6.134"),"<0>",hull_name2));
        Code=<<<
            hull_name=hull_name2;
            bonus_num=FindBonusByName(hull_name);
            pirate_hull=CreateHull(2,1000,8,PlanetRace(GetShipPlanet(Player())));
            AddItemToStorage(GetShipPlanet(Player()),pirate_hull);
            if (bonus_num>-1){SpecialToEquipment(bonus_num,pirate_hull);}
            gov_hull=1;
            DChange(14);
            exit;
        >>>
    }
    21 ~{
        Command=
        Answer=DAnswer(Format(CT("Script.PC_part6.134"),"<0>",hull_name3));
        Code=<<<
            hull_name=hull_name3;
            bonus_num=FindBonusByName(hull_name);
            pirate_hull=CreateHull(2,1000,8,PlanetRace(GetShipPlanet(Player())));
            AddItemToStorage(GetShipPlanet(Player()),pirate_hull);
            if (bonus_num>-1){SpecialToEquipment(bonus_num,pirate_hull);}
            gov_hull=1;
            DChange(14);
            exit;
        >>>
    }
    22 ~{
        Command=restart
        Answer=DAnswer('restart~'+CT("Script.PC_part6.170"));
        Code=
    }
    23 ~{
        Command=
        Answer=DAnswer(CT("Script.PC_part6.171"));
        Code=<<<
            while (GetShipPirateRank(Player())<6){RaisePirateRank(Player());}
            ShipMoney(Player(),ShipMoney(Player())-money_for_rank);
            Sound('Sound.Buy');
            ShipOut(Player());
            DChange(19);
            exit;
        >>>
    }
    24 ~{
        Command=restart
        Answer=DAnswer('restart~'+CT("Script.PC_part6.172"));
        Code=
    }
    25 ~{
        Command=restart
        Answer=DAnswer('restart~'+CT("Script.PC_part6.103"));
        Code=
    }
}
