Version=6
GlobalVars ~{
}
GlobalCode=
LocalVars ~{
    quest_complete ~{
        Type=Integer
        Value=0
    }
    counter ~{
        Type=Integer
        Value=0
    }
    temp_item ~{
        Type=Dword
        Value=0
    }
    quest_deadline ~{
        Type=Integer
        Value=0
    }
    quest_planet ~{
        Type=Integer
        Value=0
    }
    quest_started ~{
        Type=Integer
        Value=0
    }
    quest_star ~{
        Type=Dword
        Value=0
    }
    script_num ~{
        Type=Integer
        Value=0
    }
    average_distance ~{
        Type=Integer
        Value=60
    }
    cur_proximity ~{
        Type=Integer
        Value=0
    }
    proximity ~{
        Type=Integer
        Value=0
    }
    cur_planet ~{
        Type=Dword
        Value=0
    }
    reward_money ~{
        Type=Integer
        Value=0
    }
    son_name ~{
        Type=String
        Value=Богдан
    }
    quest_failed ~{
        Type=Integer
        Value=0
    }
    StarNew ~{
        Type=Dword
        Value=0
    }
    PlanetNew ~{
        Type=Dword
        Value=0
    }
    ItemRecords ~{
        Type=Dword
        Value=0
    }
    GroupNew ~{
        Type=Dword
        Value=0
    }
    DialogPlanet ~{
        Type=Dword
        Value=0
    }
    DialogCancel ~{
        Type=Dword
        Value=1
    }
    DialogComplete ~{
        Type=Dword
        Value=2
    }
}
Constellations=0
Stars ~{
    StarNew ~{
        Constellation=-1
        IsSubspace=False
        NoKling=False
        NoComeKling=False
        StarLinks ~{
        }
        Planets ~{
            PlanetNew ~{
                Race=Maloc,Peleng,People,Fei,Gaal
                Owner=Maloc,Peleng,People,Fei,Gaal
                Economy=Agriculture,Industrial,Mixed
                Government=Anarchy,Dictatorship,Monarchy,Republic,Democracy
                Range=0..100
                Dialog=
            }
        }
        Ships ~{
            0 ~{
                Count=1
                Owner=Maloc,Peleng,People,Fei,Gaal
                Type=Ranger,Warrior,Pirate,Transport,Liner,Diplomat
                IsPlayer=True
                Speed=0..10000
                Weapon=Undef
                CargoHook=0
                EmptySpace=0
                Rating=0..1000
                Status ~{
                    Trader=0..100
                    Warrior=0..100
                    Pirate=0..100
                }
                Score=0..1000000
                Strength=0.0..0.0
                Ruins=
            }
        }
    }
}
Places ~{
}
Items ~{
    ItemRecords ~{
        Place=
        Class=Unknown
        Type=0
        Size=10
        Level=1
        Radius=150
        Owner=None
        Useless=
    }
}
Groups ~{
    GroupNew ~{
        Planet=PlanetNew
        State=0(StateNew)
        Owner=Maloc,Peleng,People,Fei,Gaal
        Type=Ranger,Warrior,Pirate,Transport,Liner,Diplomat
        Count=1..1
        Speed=100..10000
        Weapon=Undef
        CargoHook=0
        EmptySpace=0
        Friendship=Free
        AddPlayer=True
        Rating=0..1000
        Score=0..1000000
        Status ~{
            Trader=0..100
            Warrior=0..100
            Pirate=0..100
        }
        SearchDist=10000
        Dialog=
        Strength=0.0..0.0
        Ruins=
    }
}
GroupLinks ~{
}
InitCode=<<<
  counter=1;
  while (counter<ArrayDim(array_script_names)){
  if (array_chosen_planets[counter]==Id(PlanetNew)){script_num=counter;}
  counter=counter+1;}
>>>
TurnCode=<<<
  if (!quest_started && ShipIsTakeoff(Player())){
  ShipOut(Player());}
  if(quest_started && !quest_complete && !quest_failed) {
    if((CurTurn()>quest_deadline) || !ItemExist(ItemRecords)) {
      array_quest_statuses[script_num]=3;
      ShipOut(Player());
      quest_failed=1;
      Ether(5,'9CDA5BB4-67D8-4C8A-9541-6E001E81DCE4',Format(CT("Script.PC_pla07.81"),"<0>",Name(PlanetNew)));
    }
  }
>>>
DialogBegin=<<<
  if(GetShipPlanet(Player())==PlanetNew) {
    if(!quest_started && request_dialog) {
      request_dialog=0;
      counter=1;
      quest_planet=0;
      cur_planet=0;cur_proximity=-1;
      while (counter<GalaxyStars()){
      quest_star=StarNearbyStars(StarNew,counter);
      if (StarOwner(quest_star)==0){
      if (SectorVisible(StarToCon(quest_star))){
      quest_planet=FindPlanet(quest_star,'NotMaloc,NotPeleng,NotFei,NotGaal,NotNone',0,100);
      if (quest_planet){
      proximity=Dist(quest_star,StarNew)-average_distance;
      if (proximity<0){proximity=-proximity;}
      if (cur_proximity<0){cur_planet=quest_planet;cur_proximity=proximity;}
      if (cur_proximity>proximity){cur_planet=quest_planet;cur_proximity=proximity;}
      }}}
      counter=counter+1;}
      quest_planet=cur_planet;
      if(!quest_planet) {
        AddDialogOverride('DialogCancel',10);
      }
      if(quest_planet) {
        quest_planet=Id(quest_planet);
        AddDialogOverride('DialogPlanet',10);
      }
    }
  }
  if(GetShipPlanet(Player())) {
    if(Id(GetShipPlanet(Player()))==quest_planet) {
      if(quest_started && !quest_complete && !quest_failed) {
        if(ItemIn(ItemRecords,Player())) {
          AddDialogOverride('DialogComplete',10);
        }
      }
    }
  }
>>>
States ~{
    StateNew ~{
        Type=None
        Attack ~{
        }
        TakeItem=
        TakeAll=False
        OutMsg=
        InMsg=
        Ether=
        Code=
    }
}
Dialogs ~{
    DialogPlanet ~{
        Code=<<<
            quest_deadline=CurTurn()+90;
            DChange(0);
            exit;
        >>>
    }
    DialogCancel ~{
        Code=<<<
            DChange(1);
            exit;
        >>>
    }
    DialogComplete ~{
        Code=<<<
            array_quest_statuses[script_num]=2;
            khan_counter=khan_counter+1;
            quest_complete=1;
            reward_money=GalaxyMoney(3);
            FreeItem(GetItemFromShip(Player(),FindItemInShip(Player(),ItemRecords)));
            ShipOut(Player());
            Ether(4,'9CDA5BB4-67D8-4C8A-9541-6E001E81DCE4',Format(CT("Script.PC_pla07.82"),"<0>",Name(PlanetNew)));
            DChange(2);
            exit;
        >>>
    }
}
DialogMsgs ~{
    0 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_pla07.83"),"<0>",ShipName(Player()),"<1>",ShipName(Player()),"<2>",Name(IdToPlanet(quest_planet)),"<3>",Name(PlanetToStar(IdToPlanet(quest_planet))),"<4>",GameDateTxtByTurn(quest_deadline)));    DAdd(0);
            DAdd(2);

        >>>
    }
    1 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_pla07.87"),"<0>",ShipName(Player())));    DAdd(1);

        >>>
    }
    2 ~{
        Name=
        Code=<<<
            DText(Format(CT("Script.PC_pla07.86"),"<0>",reward_money));    DAdd(3);

        >>>
    }
}
DialogAnswers ~{
    0 ~{
        Command=planet
        Answer=DAnswer('planet~'+CT("Script.PC_pla07.76"));
        Code=
    }
    1 ~{
        Command=planet
        Answer=DAnswer('planet~'+CT("Script.PC_pla07.88"));
        Code=
    }
    2 ~{
        Command=planet
        Answer=DAnswer('planet~'+CT("Script.PC_pla07.77"));
        Code=<<<
            temp_item=CreateQuestItem('Usl_FakedRecords');
            AddItemToShip(Player(),temp_item);
            LinkItemToScript(temp_item,ItemRecords);
            array_quest_statuses[script_num]=1;
            quest_started=1;
            Ether(3,'9CDA5BB4-67D8-4C8A-9541-6E001E81DCE4',Format(CT("Script.PC_pla07.85"),"<0>",Name(PlanetNew),"<1>",Name(StarNew),"<2>",Name(IdToPlanet(quest_planet)),"<3>",Name(PlanetToStar(IdToPlanet(quest_planet))),"<4>",GameDateTxtByTurn(quest_deadline)));
        >>>
    }
    3 ~{
        Command=planet
        Answer=DAnswer('planet~'+CT("Script.PC_pla07.79"));
        Code=
    }
}
